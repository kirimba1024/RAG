# RAG Assistant

**Claude-powered ะบะพะด-ะฐััะธััะตะฝั ะฑะตะท ะธะฝะดะตะบัะฐ: ะฝะฐะฒะธะณะฐัะธะพะฝะฝัะต ะบะฐััั + ะฟะตัะพัะฝะธัะฐ + SELECT-only ะดะพัััะฟ ะบ ะะ.**

## ๐ฏ ะััะธัะตะบัััะฐ

### ะะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ
- **ะะฐะฒะธะณะฐัะธะพะฝะฝะฐั ะบะฐััะฐ** โ ัััะฝะพะน system-ะฟัะพะผะฟั ั ะพะฟะธัะฐะฝะธะตะผ ะฟัะพะตะบัะพะฒ ะธ ะฟััะตะน.
- **Docker Sandbox** โ ะตะดะธะฝััะฒะตะฝะฝัะน ัะฟะพัะพะฑ ัะธัะฐัั ะบะพะด (read-only, ะฑะตะท ัะตัะธ).
- **ะะฐะทั ะดะฐะฝะฝัั** โ ะพะฟัะธะพะฝะฐะปัะฝัะต SELECT-ะธะฝััััะผะตะฝัั (ัะพะปัะบะพ ััะตะฝะธะต).
- **Claude** โ ัะฟัะฐะฒะปัะตั ัะธะบะปะพะผ tool calling ะธ ัะพัะผะธััะตั ะพัะฒะตั ะฝะฐ ะพัะฝะพะฒะต ัะฐะบัะพะฒ.

### ะกัะตะผะฐ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะฐะฒะธะณะฐัะธะพะฝะฝะฐั ะบะฐััะฐ                 โ
โ โข ะฟัะพะฒะตัะตะฝะฝัะต ะฟััะธ                  โ
โ โข ะบะพะฝัะตะบัั ะฟัะพะตะบัะพะฒ                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              +
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ execute_command (sandbox)           โ
โ โข rg/grep/find/ls/cat               โ
โ โข read-only FS, network_mode: none  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              +
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ SELECT_* ะธะฝััััะผะตะฝัั                โ
โ โข SQLAlchemy                        โ
โ โข ัะพะปัะบะพ SELECT                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Claude Agent                        โ
โ โข ะฟะปะฐะฝะธััะตั ะบะพะผะฐะฝะดั                 โ
โ โข ัะธัะธััะตั ะธััะพัะฝะธะบะธ                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพัะตะผั ะผั ะฑะตะท Elasticsearch
- ะั ัะพัะธะผ ััะฐะฝะธัั ะธััะพะดะฝะธะบะธ ะฟะพะปะฝะพัััั ะพััะปะฐะนะฝ ะธ ะพะฑัะฐัะฐัััั ะบ ะฝะธะผ ะฝะฐะฟััะผัั: ะฝะธะบะฐะบะพะณะพ ะธะฝะดะตะบัะฐ, ะฝะธะบะฐะบะธั ะฒัะณััะทะพะบ ะฒ ะพะฑะปะฐะบะพ.
- ะะฐััะพะดั ะฝะฐ ะฟะตัะตะธะฝะดะตะบัะฐัะธั ะธ ะฟะพะดะดะตัะถะบั ES ะฝะตัะพัะฐะทะผะตัะฝั ะผะฐะปะตะฝัะบะธะผ ะผะพะฝะพัะตะฟะพะทะธัะพัะธัะผ, ะพัะพะฑะตะฝะฝะพ ะบะพะณะดะฐ ัะฐะฝะบะธ ะฝัะถะฝะพ ะฟัะพะฒะตัััั ะฒัััะฝัั.
- ะะฐัะตะผั ะฐััะธััะตะฝัั ะดะพััะฐัะพัะฝะพ ะฝะฐะฒะธะณะฐัะธะพะฝะฝะพะน ะบะฐััั + `execute_command` + SELECT: ะฒัะต ะพัะฒะตัั ัััะพัััั ะฟะพ ัะฐะบัะธัะตัะบะธะผ ัะฐะนะปะฐะผ ะฑะตะท ะฟัะพะผะตะถััะพัะฝัั ัะปะพะตะฒ.

### ะะปััะตะฒัะต ัะฐะนะปั
- `chat.py` โ Gradio-ะธะฝัะตััะตะนั ะธ ัะธะบะป tool calling.
- `utils.py` โ ะบะพะฝัะธะณััะฐัะธั, ะฟะตัะพัะฝะธัะฐ, ะธะฝััััะผะตะฝัั `execute_command` ะธ SELECT_*, ะผะฐัะบะธัะพะฒะฐะฝะธะต.
- `mask.py` โ ะบะพะฟะธัะพะฒะฐะฝะธะต `repos/` โ `repos_safe/` ั ะฒััะตะทะฐะฝะธะตะผ ัะตะบัะตัะพะฒ.
- `templates/system_navigation.txt` โ ะฝะฐะฒะธะณะฐัะธะพะฝะฝะฐั ะบะฐััะฐ (ะพะฑะฝะพะฒะปัะตััั ะฒัััะฝัั).
- `docker-compose.yml` โ ะตะดะธะฝััะฒะตะฝะฝัะน ัะตัะฒะธั `rag-sandbox`.

## ๐ ะัััััะน ััะฐัั

### 0. ะะบััะฐะปะธะทะธััะนัะต ะฝะฐะฒะธะณะฐัะธะพะฝะฝัั ะบะฐััั
- ะะตัะตะด ะทะฐะฟััะบะพะผ ะพะฑะฝะพะฒะธัะต `templates/system_navigation.txt`. ะะฐััะฐ ะดะพะปะถะฝะฐ ัะพะดะตัะถะฐัั ะฒัะต ะฟัะพะตะบัั ะธ ะบะปััะตะฒัะต ัะฐะนะปั, ะธะฝะฐัะต ะฐััะธััะตะฝั ะฝะต ัะผะพะถะตั ัะฐะฑะพัะฐัั.
- ะัะพะฒะตัััะต ะบะฐะถะดัะน ะฟััั ะบะพะผะฐะฝะดะพะน ะฒ ะฟะตัะพัะฝะธัะต: ะบะฐััะฐ โ ะตะดะธะฝััะฒะตะฝะฝัะน ะธััะพัะฝะธะบ ะทะฝะฐะฝะธั ะพ ััััะบัััะต, ะฟะพััะพะผั ะพะฝะฐ ะฒัะตะณะดะฐ ะดะพะปะถะฝะฐ ะฑััั ะฟัะฐะฒะดะธะฒะพะน ะธ ัะฒะตะถะตะน.

### 1. ะะพะดะณะพัะพะฒััะต ะพะบััะถะตะฝะธะต
```bash
# .env
ANTHROPIC_API_KEY=sk-ant-...
CLAUDE_MODEL=claude-3-5-sonnet-latest

# ะะฟัะธะพะฝะฐะปัะฝะพ: ะฟะพะดะบะปััะตะฝะธะต ะบ ะะ
# DB_1_URL=postgresql://localhost:5432/app
# DB_1_USERNAME=user
# DB_1_PASSWORD=pass
# DB_1_DESCRIPTION=Main app database
# DB_1_TOOL_NAME=query_main_db
```

### 2. ะัะธัะฐะตะผ ะบะพะด ะพั ัะตะบัะตัะพะฒ
```bash
python mask.py  # ัะพะทะดะฐัั repos_safe/ ะธะท repos/
```

### 3. ะกะฑะพัะบะฐ ะฟะตัะพัะฝะธัั
```bash
docker compose build
docker compose up -d  # ะฟะพะดะฝะธะผะตั ัะพะปัะบะพ rag-sandbox
```

### 4. Python-ะทะฐะฒะธัะธะผะพััะธ ะธ ะทะฐะฟััะบ UI
```bash
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt -c constraints.txt
python chat.py  # http://localhost:7860
```

## ๐ง ะะฝััััะผะตะฝัั Claude

1. **execute_command**
   - ะัะฑัะต ะบะพะผะฐะฝะดั ะฒะฝัััะธ ะฟะตัะพัะฝะธัั (rg, grep, find, ls, cat, head, tail, sed, awk...).
   - ะะพะดะตะปั ะพะฑัะทะฐะฝะฐ ะฟะพััะฝััั ะฟะพะปัะทะพะฒะฐัะตะปั, ััะพ ะพะฝะฐ ะธัะตั ะบะฐะถะดะพะน ะบะพะผะฐะฝะดะพะน.
2. **SELECT_* ะธะฝััััะผะตะฝัั**
   - ะะตะฝะตัะธัััั ะธ ะฒัะฟะพะปะฝััั ะบะพะฝะบัะตัะฝัะน SQL SELECT.
   - sqlparse ะณะฐัะฐะฝัะธััะตั, ััะพ ััะพ ะดะตะนััะฒะธัะตะปัะฝะพ SELECT, ะฐ statement_timeout ะทะฐัะธัะฐะตั ะะ.

ะััะณะธั ะธะฝััััะผะตะฝัะพะฒ ะฝะตั: ะฝะธะบะฐะบะพะณะพ ะฟะพะธัะบะฐ, ัะฐะฝะบะพะฒ, reranker'ะพะฒ.

## ๐บ๏ธ ะะฐะฒะธะณะฐัะธะพะฝะฝัะต ะบะฐััั

- ะคะฐะนะป `templates/system_navigation.txt` โ ััะพ ยซะบะฐััะฐ ะผะตััะฝะพััะธยป. ะ ะฝะตะน ะฟะตัะตัะธัะปะตะฝั ะฟัะพะตะบัั, ะบะปััะตะฒัะต ะดะธัะตะบัะพัะธะธ ะธ ะฟะพัะฐะณะพะฒะฐั ัััะฐัะตะณะธั ัะฐััะปะตะดะพะฒะฐะฝะธั (Controller โ Service โ Repository ะธ ั.ะด.).
- ะะฐััะฐ ัะตะดะฐะบัะธััะตััั ะฒัััะฝัั. ะัะฑะพะต ะดะพะฑะฐะฒะปะตะฝะธะต ะฝัะถะฝะพ ะฟัะพะฒะตัะธัั ะบะพะผะฐะฝะดะพะน ะฒ ะฟะตัะพัะฝะธัะต, ััะพะฑั ะธัะบะปััะธัั ะฝะตัะพัะฝัะต ะฟััะธ.
- ะัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ ะดะตะปะฐะนัะต ะฝะตัะบะพะปัะบะพ ะบะฐัั (ะฒะตัะบะธ, ะพะบััะถะตะฝะธั) ะธ ะฟะพะดะผะตะฝัะนัะต ัะฐะนะป ะฟะตัะตะด ะทะฐะฟััะบะพะผ.
- ะะตะท ะฐะบััะฐะปัะฝะพะน ะบะฐััั ะฐััะธััะตะฝั ะฑะตัะฟะพะปะตะทะตะฝ: ััะพ ะพัะฝะพะฒะฝะพะต ััะตะฑะพะฒะฐะฝะธะต ะดะปั ะฟะพะปะฝะพัััั ะพััะปะฐะนะฝ-ัะตะถะธะผะฐ ะฑะตะท ะธะฝะดะตะบัะพะฒ.

## ๐ก๏ธ ะะตะทะพะฟะฐัะฝะพััั

- `repos_safe/` ัะพะดะตัะถะธั ัะพะปัะบะพ ะพัะธัะตะฝะฝัะน ัะตะบัั: mask.py ัะดะฐะปัะตั ัะตะบัะตัั ะธะท ัะตะบััะพะฒ ะธ ะฟัะตะพะฑัะฐะทัะตั ะฑะธะฝะฐัะฝะธะบะธ ัะตัะตะท OCR/ะฟะฐััะตัั.
- Sandbox:
  - `network_mode: none`, ะฟะพะปัะทะพะฒะฐัะตะปั `nobody`, FS read-only.
  - ะะพัััะฟะฝั ะฑะฐะทะพะฒัะต Unixโััะธะปะธัั, curl/wget ะพััััััะฒััั.
  - ะขะฐะนะผะฐัั ะฝะฐ ะปัะฑัั ะบะพะผะฐะฝะดั โ 30 ัะตะบัะฝะด.
- ะะ: ัะพะปัะบะพ SELECT, statement_timeout=30s, ะฟะพะดะบะปััะตะฝะธะต ัะตัะตะท SQLAlchemy ั pre-ping.

## ๐๏ธ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

1. ะะพะปัะทะพะฒะฐัะตะปั ะทะฐะดะฐัั ะฒะพะฟัะพั โ Claude ัะธัะฐะตั ะฝะฐะฒะธะณะฐัะธะพะฝะฝัั ะบะฐััั.
2. ะะณะตะฝั ะฟะปะฐะฝะธััะตั ัะฐััะปะตะดะพะฒะฐะฝะธะต ะธ ะฒัะทัะฒะฐะตั `execute_command`, ััะพะฑั ะฟะพะดัะฒะตัะดะธัั ััััะบัััั, ะพัะบัััั ะฝัะถะฝัะต ัะฐะนะปั, ะฒััะฐัะธัั ะบะพะฝะบัะตัะฝัะต ัััะพะบะธ.
3. ะัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ ะฐะณะตะฝั ัะพัะผะธััะตั SELECT ะธ ะฒัะทัะฒะฐะตั ัะพะพัะฒะตัััะฒัััะธะน ะธะฝััััะผะตะฝั.
4. ะ ะพัะฒะตั ะฒะบะปััะฐัััั ัะพะปัะบะพ ะฟัะพะฒะตัะตะฝะฝัะต ัะฐะบัั: ะฟััะธ ะบ ัะฐะนะปะฐะผ, ะฒัะดะตัะถะบะธ ะบะพะดะฐ, ัะตะทัะปััะฐัั SQL.

## ๐๏ธ Troubleshooting

- **Sandbox ะฝะต ะพัะฒะตัะฐะตั**: `docker ps`, `docker logs rag-assistant-rag-sandbox-1`.
- **ะะพะผะฐะฝะดะฐ ัะฟะฐะปะฐ ั ะบะพะดะพะผ 126/127**: ัะฑะตะดะธัะตัั, ััะพ ะธัะฟะพะปัะทัะตัะต ััะธะปะธัั, ะบะพัะพัะฐั ัะตะฐะปัะฝะพ ะตััั ะฒ ะบะพะฝัะตะนะฝะตัะต.
- **SELECT-ะธะฝััััะผะตะฝั ะฝะต ะฟะพัะฒะธะปัั**: ะฟัะพะฒะตัััะต ะฟะตัะตะผะตะฝะฝัะต `DB_<X>_*` ะธ ััะพ `DB_<X>_TOOL_NAME` ัะฝะธะบะฐะปะตะฝ.
- **ะงะฐั ะฝะธัะตะณะพ ะฝะต ะดะตะปะฐะตั**: ะฟัะพะฒะตัััะต `ANTHROPIC_API_KEY`, ะธะฝัะตัะฝะตั ะธ ะปะพะณะธ `logs/chat.log`.

## ๐ ะะธัะตะฝะทะธั

MIT (ะตัะปะธ ะฟัะธะผะตะฝะธะผะพ)

---

ะะฐะฒะธะณะฐัะธะพะฝะฝัะต ะบะฐััั + ะฟะตัะพัะฝะธัะฐ ะดะฐัั ะฟะพะปะฝะพัััั ะปะพะบะฐะปัะฝัะน, ะบะพะฝััะพะปะธััะตะผัะน ะธ ะฟัะตะดัะบะฐะทัะตะผัะน ะฐััะธััะตะฝั. ะะฑะฝะพะฒะปัะนัะต ะบะฐััั, ะดะตัะถะธัะต ะฟะตัะพัะฝะธัั ะฐะบััะฐะปัะฝะพะน โ ะธ ัะธััะตะผะฐ ะพััะฐัััั production-ready ะฑะตะท ััะถัะปะพะน ะธะฝััะฐััััะบัััั.
