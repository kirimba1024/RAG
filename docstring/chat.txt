[LLM: —á–∏—Ç–∞–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥ –ø—Ä–∞–≤–∫–æ–π, –æ–±–Ω–æ–≤–ª—è–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–æ–≥–∏–∫–∏]

@docstring/_README.txt

–ù–ê–ó–í–ê–ù–ò–ï:
Chat Interface ‚Äî Gradio –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è RAG –∞–≥–µ–Ω—Ç–∞

SUMMARY:
Gradio –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ —Å Claude —á–µ—Ä–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã RAG.
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç streaming –æ—Ç–≤–µ—Ç–æ–≤, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
–ò—Å—Ç–æ—Ä–∏—è –Ω–µ —Ç—è–Ω–µ—Ç—Å—è –º–µ–∂–¥—É –¥–∏–∞–ª–æ–≥–∞–º–∏ ‚Äî —Ç–æ–ª—å–∫–æ summary —á–µ—Ä–µ–∑ summarize_history –∫—ç—à–∏—Ä—É–µ—Ç—Å—è.

–í–´–í–û–î–´:
- –õ–æ–∫–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã: BASE_LLM —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–¥–µ—Å—å –∏–∑ ANTHROPIC_API_KEY.
- –ò—Å—Ç–æ—Ä–∏—è –Ω–µ –ø–µ—Ä—Å–∏—Å—Ç–∏—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π message.
- Summary –∫—ç—à–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ cache_control PERSISTENT (–Ω–µ ephemeral) ‚Äî TTL 5 –º–∏–Ω—É—Ç, —ç–∫–æ–Ω–æ–º–∏—è 90% –Ω–∞ system prompt.
- Agentic loop —Å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º: while True ‚Üí stream ‚Üí extract tool_uses ‚Üí execute –°–†–ê–ó–£ ‚Üí add results ‚Üí continue.
  * Tool_use –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –¢–û–ú –ñ–ï –∑–∞–ø—Ä–æ—Å–µ (–Ω–µ –∂–¥—ë—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).
  * –°—Ç—Ä–∏–º–∏–Ω–≥ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö —Ü–∏–∫–ª–∞.
- Streaming: content_block_start/delta/stop –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ tool calls.
- Tool routing —á–µ—Ä–µ–∑ execute_tool() –∏–∑ tools.py (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–æ—É—Ç–µ—Ä).
- UI –¥–µ—Ç–∞–ª–∏: üîß –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ‚Üí ‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ (0.15s) ‚Üí > snippet‚Ä¶ (–ø–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞).
  * collapsible <details> –¥–ª—è tool calls, HTML –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, sanitize_html=False.
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –±–∞—Ç—á–µ–º –≤ tool_results.
- Stop button cancels=[submit_event, click_event] –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –¥–ª–∏–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
- –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: try/except –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥ JSON tool inputs, –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–±–æ–µ–≤.
- –¢–∞–π–º–µ—Ä—ã: perf_counter() –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI.
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ accumulated_text: [-4000:] –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞.

–ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù–´:
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ ‚Äî —Ä–∞–∑–¥—É–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑ –ø–æ–ª—å–∑—ã.
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å streaming ‚Äî –ø–ª–æ—Ö–æ–π UX –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤.
- –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å UI –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å.
- –ü–∞—Ä—Å–∏—Ç—å JSON –±–µ–∑ try/except ‚Äî –±–∏—Ç—ã–π input –æ—Ç LLM –ª–æ–º–∞–µ—Ç –≤—Å—é —Ü–µ–ø–æ—á–∫—É.
- –ñ–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è tool_use ‚Äî –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω–æ.

–ó–ê–ú–ï–¢–ö–ò:
- Gradio –≤–µ—Ä—Å–∏—è —Å sanitize_html=False –¥–ª—è HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è tool calls.
- Examples –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- Server: 0.0.0.0:7860 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ —Å–µ—Ç–∏, share=False –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
- SYSTEM_INSTRUCTION –∏ summarize_history –≤ system blocks —Å prompt caching (persistent).
- –§–æ—Ä–º–∞—Ç SUMMARY –¥–ª—è summarize_history (Claude –ø–∏—à–µ—Ç —Å–∞–º–∞, —Å–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä—É–µ—Ç):
  * [GOAL] –∑–∞–¥–∞—á–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π
  * [ANSWER] –≥–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥
  * [FACTS] –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã, ‚â§15 —Å–ª–æ–≤/–ø—É–Ω–∫—Ç
  * [PROVENANCE] –æ—Ç—á—ë—Ç –ø–æ –∫–∞–∂–¥–æ–º—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É —Å –ø—É—Ç—è–º–∏ –∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏ —Å—Ç—Ä–æ–∫
  * [DECISIONS] –ø—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è —Å –º–æ—Ç–∏–≤–∞—Ü–∏–µ–π
  * [ASSUMPTIONS] —Ä–∞–±–æ—á–∏–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è
  * [CONSTRAINTS] –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–≤–µ—Ä—Å–∏–∏, –ø—É—Ç–∏, —Å—Ö–µ–º—ã)
  * [OPEN] –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
  * [NEXT] —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥
  * [WHEN] ISO-–≤—Ä–µ–º—è + TZ
  * –†–∞–∑–º–µ—Ä: 200-600 —Ç–æ–∫–µ–Ω–æ–≤, –≤—ã–∑—ã–≤–∞—Ç—å –ù–ï —á–∞—â–µ —Ä–∞–∑–∞ –≤ 5+ —Ö–æ–¥–æ–≤.
- –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤: system prompt ~1500 —Ç–æ–∫–µ–Ω–æ–≤ √ó 10 –∑–∞–ø—Ä–æ—Å–æ–≤ = 90% —ç–∫–æ–Ω–æ–º–∏—è ($0.0045 ‚Üí $0.00045 –Ω–∞ –∑–∞–ø—Ä–æ—Å).
- –ö—ç—à TTL: 5 –º–∏–Ω—É—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (persistent), –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ summary.
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: full_history (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã), history –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ª–µ—Ç—É –¥–ª—è UI.

