- SG: автопровижининг (admin, repos, autoindex), src-cli в образе, repos init вручную.
- .env: добавлены SOURCEGRAPH_ADMIN_*, PROVISION_REPOS=1; .gitignore позволяет .env.
- Репозитории: работаем из repos/, отказ от knowledge/; REPOS_ROOT вместо KNOWLEDGE_ROOT.
- Sandbox: монтируем repos → /app, добавлен git, обновлены сообщения entrypoint.
- Sourcegraph tools: sg_search/sg_codeintel/sg_blob упрощены; добавлены sg_get_file_content, sg_list_repos, sg_list_repo_files, sg_file_chunks (символы→чанки, fallback по строкам).
- Индексация ES (build.py): полностью через SG+SCIP чанки; хэш по контенту SG; дифф манифеста против actual из SG; удаление из ES по удалённым; маскировка секретов и лог находок; ignore на уровне файла.
- Упрощение build.py: удалены ридеры/try-except/старые сплиттеры; чистый пайплайн SG→ES.
- GraphRAG: вынесен в graphrag_build.py; build.py больше не вызывает пересборку.
- tools.py: упрощён, graphrag_query без обёрток, REPOS_ROOT напрямую.
- Промпты: chat_system_gather.txt — добавлен git в список утилит.
- Прочее: удалён PROP_GRAPH_INDEX; удалены сканы по всему дереву из check.py; mask.py теперь предоставляет mask_secrets для текста.
- Рефакторинг utils.py: перенесён весь код из ignore.py (is_ignored, IGNORE_SPEC) и check.py (check_secrets_in_text, classify_secret_type, EMOJI_MAP) в utils.py для централизации утилит; удалены файлы ignore.py и check.py.
- Упрощение utils.py: удалены проверки существования REPOS_ROOT и IGNORE_FILE (правило "не страхуйся"), создан глобальный logger для utils вместо создания внутри функций; все импорты вынесены в глобальные (убраны локальные import hashlib и from mask import).
- Исправление по .cursorrules: удалены страховки от граничных случаев (if not text в clean_text), удалены комментарии (# Sourcegraph), все импорты только глобальные.
